<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<body>

<link rel="stylesheet" type="text/css" href="style.css"/>
<script type="text/javascript" 
         src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.0.1/d3.v3.min.js"></script> 
<script type="text/javascript" 
         src="http:////cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.1/underscore-min.js"></script> 

<div class="plot" id="plot1"></div>
<div class="plot" id="plot3"></div>
<div class="plot" id="plot4"></div>
<div class="plot" id="plot5"></div>
<div class="plot" id="plot6"></div> 
<div class="plot" id="plot7"></div>  
<div class="plot" id="plot8"></div>  

<script src="i3d3.js" type="text/javascript"></script>

<script>

var h = 250,
    w = 280;


function testdata(n, offset) {
    return d3.range(n)
        .map(d3.random.logNormal(Math.log(30)))
        .map(function(x) { return x + (offset && offset || 0) });
}


functionerrorbars(n, s) {
   return _.map(_.range(n), function(i) {
              return [Math.random() * s, Math.random() * s];
          });
}


function makedate(s) {
   return new Date(s.replace(/-/g, '/'));
}


var t0 = makedate("2010-10-10 00:00:00");
var t1 = makedate("2010-10-10 12:00:00");

var r0 = makedate("2010-10-10 06:00:00");  
var r1 = makedate("2010-10-10 08:00:00"); 
var tv = makedate("2010-10-10 07:00:00"); 

var data = testdata(60, 200);

i3d3.plot({data: [{type: "bars",
                   bins: data,
                   color: "rosybrown",
                   range: [t0, t1]},
                  {type: "bars",
                   bins: testdata(20),
                   opacity: 0.7,
                   range: [t0, t1]}],
           div: "plot1",
           size: [w, h],
           padding_right: 50, 
           xlabel: "UTC",
           ylabel: "N",
           extras: [{region: {min: r0, max: r1, color: "lavender"}},
                    {vbar: {pos: tv, color: "indianred"}}, 
                    {note: {x: 0.25 * w, y: 0.3 * h, text: "Preliminary",
                            color: "rosybrown", units: "pixels"}}],
});


i3d3.plot({data: [{type: "bars",
                   bins: testdata(330),
                   color: "lightgrey",
                   range: [2000, 4000]}],
           div: "plot3",
           size: [w, h],
           padding_right: 50, 
           xlabel: "Slow Monopole",
           ylabel: "Counts",
           extras: [{vbar: {pos: 2500, color: "blue"}},
                    {vbar: {pos: 3250, color: "red"}}],
});


i3d3.plot({data: [{type: "bars",
                   bins: testdata(100),
                   range: [-1, 1]}],
           div: "plot4",
           size: [w, h],
           padding_right: 50, 
           xlabel: "sin(l)",
           ylabel: "Neutrinos",
           extras: [{hbar: {pos: 100, color: "orange"}},
                    {vbar: {pos: -0.5, color: "lightgrey"}}, 
                    {region: {min: -1, max: -0.5, color: "linen"}},
                    {note: {x: 0.7 * w, y: 0.4 * h, text: "Nu_e", 
                            color: "orange", units: "pixels"}}],
});


data = testdata(15);
i3d3.plot({data: [{type: "bars",
                   bins: data,
                   errors: errorbars(15, 50),
                   error_color: "red",
                   color: "lightsalmon",
                   range: [500, 1500]}],
           div: "plot5",
           size: [w, h],
           padding_right: 50, 
           xlabel: "Source Data",
           ylabel: "Entries",
           extras: [{line: {x0: 600, y0: d3.max(data) * 0.2,
                            x1: 1300, y1: d3.max(data) * 0.6,
                            color: "darkolivegreen"}},
                    {note: {x: 0.4 * w, y: 0.5 * h, text: "Bad Fit", 
                            color: "darkolivegreen", units: "pixels"}}],

});


function sample_curve(ampl, phase, noise_weight, offset, sig2) {
    return d3.range(50).map(function(i) { 
         var x = 0.1 * i; 
         return {x: x, y: ampl * (Math.exp(-(Math.pow(x - phase, 2)/sig2)) +  
                                  Math.random()/noise_weight + offset)}; 
     }); 
}

i3d3.plot({data: [{type: "lines",
                   values: sample_curve(200, 2, 10, 0.1, 0.4),
                   color: "blue"},
                  {type: "points",
                   values: sample_curve(200, 2, 5, 0.1, 0.4),
                   color: "lightcoral",
                   size: 1.4},
                  {type: "bars",
                   bins: testdata(15),
                   color: "lightsteelblue",
                   range: [0, 5]},
                  {type: "bars",
                   bins: testdata(30),
                   color: "goldenrod",
                   range: [2, 8]},
                  ],
             div: "plot6",
             size: [w * 2, h],
             padding_right: 50, 
             xlabel: "Stuff",
             ylabel: "Other Stuff",
             label_style: "fill: lightslategray; font-weight: bold;",
             extras: [{vbar: {pos: 2, color: "blue"}},
                      {vbar: {pos: 5, color: "red"}},
                      {note: {x: 6, y: 200,
                              text: "v2.0",
                              style: "font-size: 20; font-style: italic;"}}] 
});


function tcurve(t0, t1, n, offset, jitter) {
    return d3.range(n).map(function(i) {
         return {x: i3d3.add_time_delta(t0, (t1 - t0) * i / n),
                 y:offset + Math.random() * jitter}
     }); 
}

i3d3.plot({data: [{type: "lines",
                   values: tcurve(makedate("2013-01-10 13:45:00"),
                                  makedate("2013-01-10 13:48:00"),
                                  50, 10, 5),
                   color: "blue"},
                  {type: "points",
                   values: tcurve(makedate("2013-01-10 13:48:00"),
                                  makedate("2013-01-10 13:50:00"),
                                  8, 10, 5),
                   errors: errorbars(8, 4),
                   color: "lightcoral", 
                   error_color: "lightcoral", 
                   size: 5},
                  {type: "bars",
                   bins: _.map(testdata(15), Math.log),
                   color: "cornflowerblue",
                   range: [makedate("2013-01-10 13:47:00"),
                           makedate("2013-01-10 13:50:00")]},
                  {type: "bars",
                   bins: _.map(testdata(30), Math.log),
                   color: "cadetblue",
                   range: [makedate("2013-01-10 13:45:00"),
                           makedate("2013-01-10 13:47:00")]},
                  ],
             div: "plot7",
             size: [w * 2, h],
             padding_right: 50, 
             xlabel: "t",
             ylabel: "Zippos",
             extras: [{vbar: {pos: makedate("2013-01-10 13:46:00"), color: "grey"}},
                      {vbar: {pos: makedate("2013-01-10 13:49:00"), color: "darkolivegreen"}},
                      {note: {x: w * 0.25, y: h * 0.75,
                              text: "time-based histograms with curves and error bars",
                              units: "pixels",
                              style: "font-size: 18; font-style: italic; font-weight: bold; fill: #444;"}}]
});


function expo_points(npoints, slope) {
    return _.map(_.range(npoints), function(i) {
        return -Math.log(Math.random()) * slope;
    });
}

function exponential_histo(nnoise, pwr_noise, nsignal, pwr_signal) {
    var xnoise = expo_points(nnoise, pwr_noise); 
    var xsignal = expo_points(nsignal, pwr_signal);

    var by_rounded = _.groupBy(xnoise.concat(xsignal), function(x) {
        return Math.floor(x/500);
    });

    var bins = _.map(_.range(30), function(i) {
        return i3d3.existy(by_rounded[i]) ? by_rounded[i].length : 1; // 1 to handle log scale
    });

    return bins;
}

var eh = exponential_histo(100000, 500, 100, 5000);

i3d3.plot({data: [{type: "bars",
                   bins: eh,
                   errors: errorbars(30, 10),
                   color: "darkgray",
                   error_color: "lightpink",
                   range: [0, eh.length]}],
           div: "plot8",
           yscale: "log",
           size: [w, h],
           padding_right: 50, 
           xlabel: "bin",
           ylabel: "Events",
           extras: [{vbar: {pos: 12, color: "red"}}]});

</script>
</body>
</html>
